import { ArticleLayout } from '@/components/ArticleLayout';
import Image from 'next/image';
import mainPicture from './hero.png';
import agentList from './agent-list.png';
import agentSwagger from './swagger-ui.png';
import playground from './playground.png';

export const article = {
  author: 'Igor Katsuba',
  date: '2025-04-09',
  title: 'Building AI Agents with Mastra and Deno',
  description:
    'I discovered Mastra â€” a TypeScript framework for building AI agents. Essentially, itâ€™s an SDK for creating intelligent systems with a powerful and user-friendly high-level abstraction.',
};

export const metadata = { title: article.title, description: article.description, openGraph: {} };

export default (props) => <ArticleLayout article={article} {...props} />;

<Image src={mainPicture} alt="Building AI Agents with Mastra and Deno" />

Recently, I discovered Mastra â€” a TypeScript framework for building AI agents. Essentially, itâ€™s an
SDK for creating intelligent systems with a powerful and user-friendly high-level abstraction.
Mastra makes it easy to create advanced agents, RAG bots, work with memory, connect tools, and build
flexible workflows.

The key feature for me was that Mastra can run as a service and be interacted with via HTTP. In my
project, I use a Mastra instance as an agent hub and connect different clients to it: a Telegram bot
and a web chat. Both use the same agents with connected tools.

In this article, Iâ€™ll show you how to get started with Mastra using Deno.

---

## Quick Intro to Deno

Deno is a modern runtime for JavaScript and TypeScript, created by Ryan Dahl, the author of Node.js.
It features: â€¢ Built-in TypeScript support â€¢ Secure-by-default permissions model (sandbox) â€¢ A clean
module system without node_modules â€¢ Built-in tools for formatting, testing, and benchmarking

Iâ€™m inspired by its â€œeverything out of the boxâ€ philosophy. And recently, Deno also added support
for npm packages â€” which makes integration with libraries like Mastra even easier.

---

In this example, weâ€™ll build an agent that can search for npm packages and provide version
information.

## Step 1 â€” Set Up the Project

Create a new project folder and set up deno.json:

```bash
mkdir deno-mastra && cd deno-mastra touch deno.json
```

Content of deno.json:

```
{
  "nodeModulesDir": "auto",
  "fmt": {
    "singleQuote": true
  },
  "tasks": {
    "dev": "mastra dev"
  }
}
```

The `"nodeModulesDir": "auto"` setting tells Deno to create node_modules only when needed â€” useful
for certain dependencies. Letâ€™s also create a `.gitignore`:

```
node_modules
.env
.mastra
```

Now install the necessary dependencies:

```bash
deno install npm:@ai-sdk/openai \
 npm:@mastra/core \
 npm:@mastra/memory \
 npm:mastra \
 npm:zod
```

Hereâ€™s what weâ€™re installing:

- `@ai-sdk/openai` â€” for connecting to OpenAI models
- `@mastra/core` â€” core logic for agents
- `@mastra/memory` â€” memory and storage support
- `mastra` â€” CLI for running the Mastra server
- `zod` â€” a library for input validation and schema definitions

## Step 2 â€” Implementing Tools

Agents need â€œtoolsâ€ to interact with the outside world. Weâ€™ll create two:

- `getPackageVersion` â€” fetch specific version info for a package
- `searchPackages` â€” search for packages by keyword

Create a file `src/mastra/tools/npm-registry.ts`:

```typescript
import { createTool } from '@mastra/core/tools';
import { z } from 'zod';

export const getPackageVersion = createTool({
  id: 'getPackageVersion',
  description: 'Get the version of a npm package',
  inputSchema: z.object({
    name: z.string().describe('Package name like "react" or "@angular/core"'),
    version: z.string().describe('Version or tag like "18.2.0" or "latest"'),
  }),
  execute: async ({ context }) => {
    const response = await fetch(
      `https://registry.npmjs.org/${encodeURIComponent(context.name)}/${encodeURIComponent(context.version)}`,
    );
    return await response.json();
  },
});

export const searchPackages = createTool({
  id: 'searchPackages',
  description: 'Search for npm packages',
  inputSchema: z.object({ query: z.string().describe('Search term like "react" or "angular"') }),
  execute: async ({ context }) => {
    const response = await fetch(
      `https://registry.npmjs.org/-/v1/search?text=${encodeURIComponent(context.query)}&size=10`,
    );
    return await response.json();
  },
});
```

## Step 3 â€” Setting Up Memory

Create `src/mastra/agents/npm/memory.ts`:

```typescript
import { LibSQLStore } from '@mastra/core/storage/libsql';
import { LibSQLVector } from '@mastra/core/vector/libsql';
import { Memory } from '@mastra/memory';

const storage = new LibSQLStore({ config: { url: 'file:./.mastra/memory.db' } });

const vector = new LibSQLVector({ connectionUrl: 'file:./.mastra/vector.db' });

export const memory = new Memory({ storage, vector });
```

Weâ€™re using SQLite via libSQL â€” the simplest way to set up message history and vector memory.

## Step 4 â€” Creating the Agent

First, define the agentâ€™s instructions in `src/mastra/agents/npm/instructions.ts`:

```typescript
export const instructions = `
You are a helpful npm assistant that provides accurate npm package information.

Your primary function is to help users get npm package information. When responding:

- Always ask for a package name if none is provided
- If the package name isnâ€™t in English, please translate it
- Include relevant details like version, description, and dependencies
- Keep responses concise but informative

Use the getPackageVersion tool to fetch a specific version of an npm package. Use the searchPackages
tool to search for npm packages.

If you don't know which version of a package to use, use the latest tag. `;
```

Now create the agent in `src/mastra/agents/npm/agent.ts`:

```typescript
import { Agent } from '@mastra/core';
import { memory } from './memory.ts';
import { openai } from '@ai-sdk/openai';
import { getPackageVersion, searchPackages } from '../../tools/npm-registry.ts';
import { instructions } from './instructions.ts';

export const npmAgent = new Agent({
  name: 'NPM Agent',
  instructions,
  model: openai('gpt-4o-mini'),
  tools: { getPackageVersion, searchPackages },
  memory,
});
```

## Step 5 â€” Running the Mastra Server

Create `src/mastra/index.ts`:

```typescript
import { Mastra } from '@mastra/core';
import { npmAgent } from './agents/npm/agent.ts';

export const mastra = new Mastra({ agents: { npmAgent } });
```

Add a `.env` file to your project root:

```
OPENAI_API_KEY=sk-proj-...
```

Now start the server:

```bash
deno task dev
```

Test the agent from the terminal:

```bash
curl -X POST http://localhost:4111/api/agents/npmAgent/generate \
 -H "Content-Type: application/json" \
 -d '{"messages": ["react"]}'
```

If you get a detailed response â€” itâ€™s working!

## Sandbox and Swagger

Open http://localhost:4111 in your browser â€” youâ€™ll see a UI for interacting with agents:

<Image src={agentList} alt="Agent List" />

The UI is a playground for testing agents. Playground has a chat interface, where you can interact
with the agent:

<Image src={playground} alt="Playground" />

Thereâ€™s also Swagger documentation, where you can see all HTTP endpoints and test requests right
from your browser.

<Image src={agentSwagger} alt="Agent Swagger" />

## Final Project

You can find the full project here:

ðŸ‘‰ [github.com/IKatsuba/deno-mastra](https://github.com/IKatsuba/deno-mastra)

## Conclusion

Mastra is a powerful tool for building AI agents, and together with Deno, it becomes an even more
convenient development platform. You can build, run, and test agents in one environment and connect
them to any apps via HTTP API.

In future articles, Iâ€™ll cover how to build and deploy Mastra servers across different platforms.
Stay tuned!
